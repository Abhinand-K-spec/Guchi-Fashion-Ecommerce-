<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup Page</title>
  <link rel="stylesheet" href="/css/signup.css" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    .alert {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-weight: bold;
      text-align: center;
    }

    a {
      text-decoration: none;
    }

    .alert-danger {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .password-wrapper {
      position: relative;
      width: 100%;
    }

    .password-wrapper input {
      width: 100%;
      padding-right: 40px;
      /* space for the eye icon */
    }

    .toggle-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #555;
      font-size: 18px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="left">
      <h2>Get Started Now</h2>
      <form id="signform" method="post" action="/signup">
        <label for="name">Name</label>
        <input type="text" name="name" id="name" placeholder="Enter your name" maxlength="15" minlength="3"/>
        <div id="err1" class="inputerror"></div>

        <label for="email">Email address</label>
        <input type="text" name="email" id="email" placeholder="Enter your email" maxlength="20"/>
        <div id="err2" class="inputerror"></div>

        <label for="password">Password</label>
        <div class="password-wrapper">
          <input type="password" name="password" id="password" placeholder="Enter your password" maxlength="15"/>
          <span class="toggle-eye" id="togglePassword">
            <i class="fa fa-eye"></i>
          </span>
        </div>
        <div id="err3" class="inputerror"></div>

        <label for="cPassword">Confirm Password</label>
        <div class="password-wrapper">
          <input type="password" name="cPassword" id="cPassword" placeholder="Confirm your password" />
          <span class="toggle-eye" id="toggleCPassword">
            <i class="fa fa-eye"></i>
          </span>
        </div>
        <div id="err5" class="inputerror"></div>



        <label for="referralCode">Referral Code (Optional)</label>
        <input type="text" name="referralCode" id="referralCode" placeholder="Enter referral code" maxlength="10"/>
        <div id="err4" class="inputerror"></div>

        <% if (locals.msg && msg.length> 0) { %>
          <div id="message" class="alert alert-danger text-center">
            <%= msg %>
          </div>
          <% } %>

            <button type="submit">Signup</button>
      </form>

      <div class="divider"><span>or</span></div>

      <div class="google-btn">
        <a href="/auth/google" class="btn-btn-primary">
          <img src="https://www.gstatic.com/images/branding/googleg/1x/googleg_standard_color_128dp.png" alt="Google"
            width="24" height="24" />
          Sign up with Google
        </a>
      </div>

      <div class="signin-link">
        Have an account? <a href="/login">Sign In</a>
      </div>
    </div>

    <div class="right">
      <img src="guchi-logo.png" alt="Logo" class="logo" />
      <img src="img/guchi/signup.jpg" alt="Clothes" class="background-img" />
    </div>
  </div>

  <script>
    const nameid = document.getElementById('name');
    const emailid = document.getElementById('email');
    const password = document.getElementById('password');
    const cPassword = document.getElementById('cPassword');
    const referralCode = document.getElementById('referralCode');

    const error1 = document.getElementById('err1');
    const error2 = document.getElementById('err2');
    const error3 = document.getElementById('err3');  // password error
    const error5 = document.getElementById('err5');  // confirm password error
    const error4 = document.getElementById('err4');

    const signform = document.getElementById('signform');

    // Eye Toggle for Password
    const togglePassword = document.getElementById("togglePassword");
    togglePassword.addEventListener("click", () => {
      const type = password.type === "password" ? "text" : "password";
      password.type = type;

      togglePassword.innerHTML =
        type === "password"
          ? `<i class="fa fa-eye"></i>`
          : `<i class="fa fa-eye-slash"></i>`;
    });

    // Eye Toggle for Confirm Password
    const toggleCPassword = document.getElementById("toggleCPassword");
    toggleCPassword.addEventListener("click", () => {
      const type = cPassword.type === "password" ? "text" : "password";
      cPassword.type = type;

      toggleCPassword.innerHTML =
        type === "password"
          ? `<i class="fa fa-eye"></i>`
          : `<i class="fa fa-eye-slash"></i>`;
    });



    function nameValidate() {
      const nameval = nameid.value.trim();
      const namepattern = /^[A-Za-z\s]+$/;

      if (nameval === "") {
        error1.textContent = "Please input your name";
        error1.style.display = "block";
        return false;
      }
      if (!namepattern.test(nameval)) {
        error1.textContent = "Please enter a valid name";
        error1.style.display = "block";
        return false;
      }
      if (nameval.length < 3) {
        error1.textContent = "Name must be at least 3 characters long";
        error1.style.display = "block";
        return false;
      }

      error1.style.display = "none";
      return true;
    }


    function emailValidate() {
      const emailval = emailid.value.trim();
      const emailpattern = /^[a-zA-Z0-9][a-zA-Z0-9._-]*@[a-zA-Z0-9.-]+\.[A-Za-z]{2,}$/;

      if (!emailpattern.test(emailval)) {
        error2.textContent = "Please enter a valid email";
        error2.style.display = "block";
        return false;
      }

      error2.style.display = "none";
      return true;
    }


    function passwordValidate() {
      const passval = password.value.trim();
      const passpattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/;

      if (passval === "") {
        error3.textContent = "Please enter password";
        error3.style.display = "block";
        return false;
      }
      if (!passpattern.test(passval)) {
        error3.textContent = "Password must contain uppercase, lowercase, number, and special character, and be at least 8 characters long.";
        error3.style.display = "block";
        return false;
      }

      error3.style.display = "none";
      return true;
    }


    function confirmPasswordValidate() {
      const passval = password.value.trim();
      const cPassVal = cPassword.value.trim();

      if (cPassVal === "") {
        error5.textContent = "Please confirm your password";
        error5.style.display = "block";
        return false;
      }
      if (passval !== cPassVal) {
        error5.textContent = "Passwords do not match";
        error5.style.display = "block";
        return false;
      }

      error5.style.display = "none";
      return true;
    }


    // Real-time remove errors
    nameid.addEventListener("input", nameValidate);
    emailid.addEventListener("input", emailValidate);
    password.addEventListener("input", passwordValidate);
    cPassword.addEventListener("input", confirmPasswordValidate);
    referralCode.addEventListener("input", referralCodeValidate);


    document.addEventListener("DOMContentLoaded", function () {
      signform.addEventListener("submit", function (e) {
        const isNameValid = nameValidate();
        const isEmailValid = emailValidate();
        const isPasswordValid = passwordValidate();
        const isConfirmPasswordValid = confirmPasswordValidate();
        const isReferralCodeValid = referralCodeValidate();

        if (!isNameValid || !isEmailValid || !isPasswordValid || !isConfirmPasswordValid || !isReferralCodeValid) {
          e.preventDefault();
        }
      });
    });
  </script>


</body>

</html>